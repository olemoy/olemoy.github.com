<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animated Car Illusion</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            overflow: hidden;
            background: #87CEEB;
            font-family: Arial, sans-serif;
        }

        .container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        /* Animated background layer */
        .background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        /* Road stripes animation */
        .road {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40%;
            background: #333;
            z-index: 2;
        }

        .road-stripe {
            position: absolute;
            bottom: 30%;
            height: 8px;
            width: 100px;
            background: #FFF;
            opacity: 0.8;
        }

        /* Cloud layers for parallax effect */
        .clouds {
            position: absolute;
            width: 200%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 3;
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 100px;
            opacity: 0.7;
        }

        /* Car container */
        .car-container {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            width: 640px;
            height: auto;
        }

        .car-image {
            width: 100%;
            height: auto;
            display: block;
            position: relative;
            z-index: 2;
        }

        /* Wheel overlays */
        .wheel {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #666, #222, #000);
            border: 3px solid #333;
            z-index: 1;
        }

        .wheel::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(0deg, transparent 45%, #444 45%, #444 55%, transparent 55%),
                linear-gradient(90deg, transparent 45%, #444 45%, #444 55%, transparent 55%),
                linear-gradient(45deg, transparent 45%, #555 45%, #555 55%, transparent 55%),
                linear-gradient(-45deg, transparent 45%, #555 45%, #555 55%, transparent 55%);
            border-radius: 50%;
        }

        .wheel::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30%;
            height: 30%;
            background: radial-gradient(circle, #888, #333);
            border-radius: 50%;
            border: 2px solid #222;
        }

        /* Control panel */
        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            color: white;
            max-width: 300px;
        }

        .controls button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #4CAF50;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .controls button:hover {
            background: #45a049;
        }

        .controls button.pause {
            background: #f44336;
        }

        .controls button.pause:hover {
            background: #da190b;
        }

        .controls input[type="text"],
        .controls input[type="file"] {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
            border: none;
            font-size: 12px;
        }

        .controls label {
            display: block;
            margin-top: 10px;
            font-size: 12px;
            color: #ddd;
        }

        .controls .section {
            border-top: 1px solid #555;
            padding-top: 10px;
            margin-top: 10px;
        }

        .controls .section:first-child {
            border-top: none;
            padding-top: 0;
            margin-top: 0;
        }

        .info-text {
            font-size: 11px;
            color: #aaa;
            margin: 5px 0;
            line-height: 1.4;
        }

        /* Loading state */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="loading" id="loading">Loading car image...</div>

        <!-- Background elements -->
        <div class="background">
            <div class="clouds" id="clouds"></div>
        </div>

        <!-- Road -->
        <div class="road" id="road"></div>

        <!-- Car with wheels -->
        <div class="car-container" id="carContainer" style="display: none;">
            <img src="https://unsplash.com/photos/DyiDM013ARs/download?force=true&w=640"
                 alt="Car"
                 class="car-image"
                 id="carImage"
                 crossorigin="anonymous">
            <!-- Wheels will be dynamically positioned -->
            <div class="wheel" id="wheelFront"></div>
            <div class="wheel" id="wheelRear"></div>
        </div>

        <!-- Controls -->
        <div class="controls">
            <div class="section">
                <strong>Animation Controls</strong>
                <button id="playPauseBtn">Pause</button>
                <button id="speedUpBtn">Speed Up</button>
                <button id="slowDownBtn">Slow Down</button>
                <div style="margin-top: 10px;">Speed: <span id="speedDisplay">1x</span></div>
            </div>

            <div class="section">
                <strong>Image Options</strong>
                <label for="customImage">Upload Custom Car Image:</label>
                <input type="file" id="customImage" accept="image/*">
                <p class="info-text">Upload a car image with transparent background (PNG) for best results</p>
            </div>

            <div class="section">
                <strong>Remove.bg Integration</strong>
                <label for="removeBgKey">Remove.bg API Key:</label>
                <input type="text" id="removeBgKey" placeholder="Enter API key">
                <button id="processImageBtn">Process Current Image</button>
                <p class="info-text">Get free API key at <a href="https://remove.bg/api" target="_blank" style="color: #4CAF50;">remove.bg/api</a></p>
                <div id="processingStatus" style="margin-top: 5px; font-size: 11px;"></div>
            </div>

            <div class="section">
                <strong>Wheel Adjustment</strong>
                <label for="wheelSize">Wheel Size: <span id="wheelSizeValue">25%</span></label>
                <input type="range" id="wheelSize" min="15" max="35" value="25" style="width: 100%;">
                <label for="wheelFrontPos">Front Wheel Pos: <span id="wheelFrontValue">65%</span></label>
                <input type="range" id="wheelFrontPos" min="50" max="80" value="65" style="width: 100%;">
                <label for="wheelRearPos">Rear Wheel Pos: <span id="wheelRearValue">25%</span></label>
                <input type="range" id="wheelRearPos" min="10" max="40" value="25" style="width: 100%;">
            </div>
        </div>
    </div>

    <!-- anime.js v4 -->
    <script src="https://cdn.jsdelivr.net/npm/animejs@4.0.0-beta.101/lib/anime.es.js" type="module"></script>

    <script type="module">
        import anime from 'https://cdn.jsdelivr.net/npm/animejs@4.0.0-beta.101/lib/anime.es.js';

        let isPaused = false;
        let speedMultiplier = 1;
        let animations = [];
        let wheelSizePercent = 25;
        let wheelFrontPercent = 65;
        let wheelRearPercent = 25;

        // Initialize clouds
        function createClouds() {
            const cloudsContainer = document.getElementById('clouds');
            const cloudCount = 8;

            for (let i = 0; i < cloudCount; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                const size = 60 + Math.random() * 80;
                cloud.style.width = size + 'px';
                cloud.style.height = size * 0.6 + 'px';
                cloud.style.left = Math.random() * 200 + '%';
                cloud.style.top = Math.random() * 40 + '%';
                cloudsContainer.appendChild(cloud);
            }
        }

        // Initialize road stripes
        function createRoadStripes() {
            const road = document.getElementById('road');
            const stripeCount = 15;

            for (let i = 0; i < stripeCount; i++) {
                const stripe = document.createElement('div');
                stripe.className = 'road-stripe';
                stripe.style.left = (i * 150) + 'px';
                road.appendChild(stripe);
            }
        }

        // Position wheels on the car image
        function positionWheels() {
            const carContainer = document.getElementById('carContainer');
            const carImage = document.getElementById('carImage');
            const wheelFront = document.getElementById('wheelFront');
            const wheelRear = document.getElementById('wheelRear');

            // Wait for image to load to get proper dimensions
            if (carImage.complete) {
                setupWheelPositions();
            } else {
                carImage.addEventListener('load', setupWheelPositions);
            }

            function setupWheelPositions() {
                const imgWidth = carImage.offsetWidth;
                const imgHeight = carImage.offsetHeight;

                // Wheel size relative to image height
                const wheelSize = imgHeight * (wheelSizePercent / 100);

                // Position wheels (adjust these percentages based on actual car image)
                // Front wheel (right side)
                wheelFront.style.width = wheelSize + 'px';
                wheelFront.style.height = wheelSize + 'px';
                wheelFront.style.left = (imgWidth * (wheelFrontPercent / 100)) + 'px';
                wheelFront.style.bottom = (imgHeight * 0.15) + 'px';

                // Rear wheel (left side)
                wheelRear.style.width = wheelSize + 'px';
                wheelRear.style.height = wheelSize + 'px';
                wheelRear.style.left = (imgWidth * (wheelRearPercent / 100)) + 'px';
                wheelRear.style.bottom = (imgHeight * 0.15) + 'px';

                // Hide loading and show car
                document.getElementById('loading').style.display = 'none';
                carContainer.style.display = 'block';

                // Start animations if not already started
                if (animations.length === 0) {
                    startAnimations();
                }
            }
        }

        // Update wheel positions in real-time
        function updateWheelPositions() {
            const carImage = document.getElementById('carImage');
            const wheelFront = document.getElementById('wheelFront');
            const wheelRear = document.getElementById('wheelRear');

            if (!carImage.offsetWidth) return;

            const imgWidth = carImage.offsetWidth;
            const imgHeight = carImage.offsetHeight;
            const wheelSize = imgHeight * (wheelSizePercent / 100);

            wheelFront.style.width = wheelSize + 'px';
            wheelFront.style.height = wheelSize + 'px';
            wheelFront.style.left = (imgWidth * (wheelFrontPercent / 100)) + 'px';

            wheelRear.style.width = wheelSize + 'px';
            wheelRear.style.height = wheelSize + 'px';
            wheelRear.style.left = (imgWidth * (wheelRearPercent / 100)) + 'px';
        }

        // Start all animations
        function startAnimations() {
            // Wheel rotation animation
            const wheelAnimation = anime({
                targets: ['.wheel'],
                rotate: '1turn',
                duration: 1000,
                easing: 'linear',
                loop: true
            });
            animations.push(wheelAnimation);

            // Road stripes animation
            const roadStripesAnimation = anime({
                targets: '.road-stripe',
                translateX: -150,
                duration: 500,
                easing: 'linear',
                loop: true,
                delay: anime.stagger(100)
            });
            animations.push(roadStripesAnimation);

            // Clouds parallax animation (slower)
            const cloudsAnimation = anime({
                targets: '.clouds',
                translateX: '-50%',
                duration: 15000,
                easing: 'linear',
                loop: true
            });
            animations.push(cloudsAnimation);

            // Individual cloud movement
            const cloudElements = document.querySelectorAll('.cloud');
            cloudElements.forEach((cloud, index) => {
                const cloudAnim = anime({
                    targets: cloud,
                    translateX: -200,
                    duration: 8000 + (index * 1000),
                    easing: 'linear',
                    loop: true
                });
                animations.push(cloudAnim);
            });

            // Add subtle car bounce for realism
            const carBounce = anime({
                targets: '#carContainer',
                translateY: ['-50%', 'calc(-50% - 5px)', '-50%'],
                duration: 2000,
                easing: 'easeInOutSine',
                loop: true
            });
            animations.push(carBounce);
        }

        // Control functions
        function togglePlayPause() {
            isPaused = !isPaused;
            const btn = document.getElementById('playPauseBtn');

            animations.forEach(anim => {
                if (isPaused) {
                    anim.pause();
                    btn.textContent = 'Play';
                    btn.classList.remove('pause');
                } else {
                    anim.play();
                    btn.textContent = 'Pause';
                    btn.classList.add('pause');
                }
            });
        }

        function updateSpeed() {
            animations.forEach(anim => {
                const currentTime = anim.currentTime;
                anim.duration = anim.duration / speedMultiplier;
                anim.seek(currentTime);
            });
            document.getElementById('speedDisplay').textContent = speedMultiplier.toFixed(1) + 'x';
        }

        function speedUp() {
            speedMultiplier = Math.min(speedMultiplier + 0.5, 3);
            updateSpeed();
        }

        function slowDown() {
            speedMultiplier = Math.max(speedMultiplier - 0.5, 0.5);
            updateSpeed();
        }

        // Handle custom image upload
        function handleCustomImage(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const carImage = document.getElementById('carImage');
                carImage.src = e.target.result;
                document.getElementById('loading').textContent = 'Loading custom image...';
                document.getElementById('loading').style.display = 'block';
                document.getElementById('carContainer').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        // Process image with remove.bg API
        async function processWithRemoveBg() {
            const apiKey = document.getElementById('removeBgKey').value.trim();
            const statusDiv = document.getElementById('processingStatus');

            if (!apiKey) {
                statusDiv.textContent = '⚠️ Please enter an API key';
                statusDiv.style.color = '#f44336';
                return;
            }

            statusDiv.textContent = '⏳ Processing image...';
            statusDiv.style.color = '#FFC107';

            try {
                const carImage = document.getElementById('carImage');
                const imageUrl = carImage.src;

                // Convert image to blob if it's a data URL
                let imageBlob;
                if (imageUrl.startsWith('data:')) {
                    const response = await fetch(imageUrl);
                    imageBlob = await response.blob();
                } else {
                    // For external URLs, we need to fetch through a proxy or use direct URL
                    imageBlob = null;
                }

                const formData = new FormData();
                if (imageBlob) {
                    formData.append('image_file', imageBlob);
                } else {
                    formData.append('image_url', imageUrl);
                }
                formData.append('size', 'auto');

                const response = await fetch('https://api.remove.bg/v1.0/removebg', {
                    method: 'POST',
                    headers: {
                        'X-Api-Key': apiKey
                    },
                    body: formData
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.errors?.[0]?.title || 'Failed to process image');
                }

                const blob = await response.blob();
                const processedUrl = URL.createObjectURL(blob);

                // Update car image with processed version
                carImage.src = processedUrl;
                statusDiv.textContent = '✓ Background removed successfully!';
                statusDiv.style.color = '#4CAF50';

                // Save API key to localStorage for convenience
                localStorage.setItem('removeBgApiKey', apiKey);

            } catch (error) {
                statusDiv.textContent = `❌ Error: ${error.message}`;
                statusDiv.style.color = '#f44336';
                console.error('Remove.bg error:', error);
            }
        }

        // Wheel adjustment handlers
        function handleWheelSizeChange(event) {
            wheelSizePercent = parseInt(event.target.value);
            document.getElementById('wheelSizeValue').textContent = wheelSizePercent + '%';
            updateWheelPositions();
        }

        function handleWheelFrontChange(event) {
            wheelFrontPercent = parseInt(event.target.value);
            document.getElementById('wheelFrontValue').textContent = wheelFrontPercent + '%';
            updateWheelPositions();
        }

        function handleWheelRearChange(event) {
            wheelRearPercent = parseInt(event.target.value);
            document.getElementById('wheelRearValue').textContent = wheelRearPercent + '%';
            updateWheelPositions();
        }

        // Event listeners
        document.getElementById('playPauseBtn').addEventListener('click', togglePlayPause);
        document.getElementById('speedUpBtn').addEventListener('click', speedUp);
        document.getElementById('slowDownBtn').addEventListener('click', slowDown);
        document.getElementById('customImage').addEventListener('change', handleCustomImage);
        document.getElementById('processImageBtn').addEventListener('click', processWithRemoveBg);
        document.getElementById('wheelSize').addEventListener('input', handleWheelSizeChange);
        document.getElementById('wheelFrontPos').addEventListener('input', handleWheelFrontChange);
        document.getElementById('wheelRearPos').addEventListener('input', handleWheelRearChange);

        // Load saved API key from localStorage
        const savedApiKey = localStorage.getItem('removeBgApiKey');
        if (savedApiKey) {
            document.getElementById('removeBgKey').value = savedApiKey;
        }

        // Handle image loading errors
        document.getElementById('carImage').addEventListener('error', () => {
            document.getElementById('loading').textContent =
                'Failed to load image. Using placeholder setup...';
            // Still show the wheels and animations even if image fails
            document.getElementById('carContainer').style.display = 'block';
            positionWheels();
        });

        // Initialize
        createClouds();
        createRoadStripes();
        positionWheels();
    </script>
</body>
</html>
